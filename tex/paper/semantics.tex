Resources will provide a refinement of the semantics of typed programs.
More precisely, we provide a standard semantics of merely well \emph{typed}
terms into $\mathrm{Set}$, which allows us to interpret terms as programs.
Then, our semantics of well \emph{resourced} terms is into indexed binary
relations over elements of the $\mathrm{Set}$ semantics.

In addition to the parametricity of the syntax over the choice of resource
annotations, the semantics is parametrised over a monoidal category of worlds,
which keep track of resources and restrictions we have accumulated.
Also, the choice of how to interpret the base type and the bang modality is
fairly liberal.

\subsection{Semantics of typed terms}

We begin with a standard semantics in $\mathrm{Set}$ of typed terms.
We do not require terms to be well resourced at this stage, and consequently
this semantics is entirely oblivious to the concerns of resourcing.
In particular, $\excl{\rho}{}$ has no effect, and the two types of products are
conflated.

\begin{displaymath}
  \begin{array}{c@{\hspace{0.5in}}c}
    \begin{eqns}
      \sem{\base} &=& X_\base \\
      \sem{\excl{\rho}{A}} &=& \sem{A} \\
      \sem{\tensorOne} &=& \{*\} \\
      \sem{\withTOne} &=& \{*\} \\
      \sem{\sumTZero} &=& \{\} \\
    \end{eqns}
    &
    \begin{eqns}
      \\
      \sem{\fun{A}{B}} &=& \sem{A} \rightarrow \sem{B} \\
      \sem{\tensor{A}{B}} &=& \sem{A} \times \sem{B} \\
      \sem{\withT{A}{B}} &=& \sem{A} \times \sem{B} \\
      \sem{\sumT{A}{B}} &=& \sem{A} \uplus \sem{B} \\
    \end{eqns}
  \end{array}
\end{displaymath}

Typing contexts $\Gamma$ are interpreted as cartesian products of their points.
Each typing derivation $\Gamma \vdash M : A$ is interpreted as a function
$\sem{M} : \sem{\Gamma} \to \sem{A}$ in the standard way, extended trivially for
the $\excl{\rho}{}$ rules.

\subsection{Semantics of resourced terms}

The refinement resources provide on top of this is a Kripke-indexed logical
relation $\sem{A}^R : \mathcal{W}^{op} \to \operatorname{Rel}\sem{A}$ for each type $A$.
$\mathcal{W}$ is assumed to be a symmetric promonoidal category.

Let $\left| X \right|$ be the proposition that $X$ is inhabited.

\begin{displaymath}
  \begin{array}{rllcl}
    \sem{\base}^R & w & (c,c') &\gets& R_\base~w~(c,c') \\
    \sem{\fun{A}{B}}^R & w & (f,f')
                               &\gets& \forall x,y.~
                                 \left| \mathcal W(x, y \otimes w) \right|
                                 \Rightarrow \\
    &&&& \forall a,a'.~\sem{A}^R~y~(a,a')
                                 \Rightarrow \sem{B}^R~x~(f~a,f'~a') \\
    \sem{\excl{\rho}{A}}^R & w & (a,a') &\gets& \oc_\rho \sem{A}^R~w~(a,a') \\
    \sem{\tensorOne}^R & w & (*,*) &\gets& \left|\mathcal W(w, I)\right| \\
    \sem{\tensor{A}{B}}^R & w & ((a,b),(a',b'))
                               &\gets& \exists x,y.~
                                 \left| \mathcal W(w, x \otimes y) \right|
                                 \wedge \sem{A}^R~x~(a,a')
                                 \wedge \sem{B}^R~y~(b,b') \\
    \sem{\withTOne}^R & w & (*,*) &\gets& \top \\
    \sem{\withT{A}{B}}^R & w & ((a,b),(a',b')) &\gets&
    \sem{A}^R~w~(a,a') \wedge \sem{B}^R~w~(b,b') \\
    \sem{\sumT{A}{B}}^R & w & (\operatorname{inl} a,\operatorname{inl} a')
                               &\gets& \sem{A}^R~w~(a,a') \\
    \sem{\sumT{A}{B}}^R & w & (\operatorname{inr} b,\operatorname{inr} b')
                               &\gets& \sem{B}^R~w~(b,b') \\
  \end{array}
\end{displaymath}

Type-and-resourcing contexts $\ctx{\Gamma}{R}$ are interpreted as
tensor products of banged points.

%\begin{displaymath}
%  \begin{eqns}
%    \sem{\ctx{\cdot}{\cdot}}^R~w~(*,*) &=& \mathcal W(w, I) \\
%    \sem{\ctx{\Gamma}{R}, \ctxvar{x}{A}{\rho}}^R~w
%    ~((\gamma,a), (\gamma',a')) &=& 
%  \end{eqns}
%%  \sem{\ctxvar{x_1}{A_1}{\rho_1}, \ldots \ctxvar{x_n}{A_n}{\rho_n}} \coloneqq
%\end{displaymath}

\subsection{Fundamental lemma}

\begin{displaymath}
  \ctx{\Gamma}{R} \vdash t : T \implies \sem{\ctx{\Gamma}{R}}^R w~(\gamma, \gamma') \implies \sem{T}^R w~(\sem{t}\gamma, \sem{t}\gamma')
\end{displaymath}
