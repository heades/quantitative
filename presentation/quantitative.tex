\documentclass{beamer}

\usepackage{booktabs}
\usepackage{subcaption}

\usepackage{stmaryrd}
\usepackage{mathpartir}
\usepackage{amssymb}
\usepackage{cmll}
\usepackage{xcolor}
\usepackage{makecell}
\usepackage{tikz-cd}

\usetikzlibrary{positioning}

\input{macros}

\title{Context Constrained Computation}
\subtitle{via a linear-like lambda calculus}
\author{Bob Atkey\inst{1} \and James Wood\inst{1}}
\institute{\inst{1}University of Strathclyde}
\date{TyDe Workshop, 2018}

\begin{document}
  \frame{\titlepage}
  \begin{frame}
    \frametitle{Motivation}

    \begin{itemize}
    \item Constrain how variables are used
    \item Derive more free theorems about constrained programs
    \item Generalise the ``how many'' of linear typing \pause
      \begin{itemize}
      \item At what security level? -- information flow \pause
      \item How far away? -- sensitivity analysis \pause
      \item In which direction? -- monotonicity
      \end{itemize}
    \end{itemize}
  \end{frame}
  \begin{frame}
    \frametitle{Moving parts}
    %Basic syntax

    \begin{columns}[onlytextwidth,T]
      \begin{column}{0.5\textwidth}
        \only<1>{
          \centering
          Partially ordered semiring
          \begin{table}[]
            \begin{tabular}{c|ccc}
              $+$      & $0$      & $1$      & $\omega$
              \\ \hline
              $0$      & $0$      & $1$      & $\omega$
              \\
              $1$      & $1$      & $\omega$ & $\omega$
              \\
              $\omega$ & $\omega$ & $\omega$ & $\omega$
            \end{tabular}
          \end{table}
          \begin{table}[]
            \begin{tabular}{c|ccc}
              $\cdot$  & $0$ & $1$      & $\omega$
              \\ \hline
              $0$      & $0$ & $0$      & $0$
              \\
              $1$      & $0$ & $1$      & $\omega$
              \\
              $\omega$ & $0$ & $\omega$ & $\omega$
            \end{tabular}
          \end{table}
          \begin{tikzcd}[ampersand replacement=\&, tips=false, column sep=0.5em,
                         row sep=1em]
            0 \ar{dr} \&\& 1 \ar{dl}
            \\
            \& \omega \&
          \end{tikzcd}
        }
        \only<2>{
          \centering
          Partially ordered semiring
          \begin{align*}
            \mathcal{T} &= \mathbb{R} \cup \{\infty\}
          \end{align*}
          \begin{align*}
            {+} &= \min \\
            {\cdot} &= +
          \end{align*}
          \begin{tikzpicture}[-, node distance=0.5em]
            \node (0) {$0$};
            \node[above=of 0] (1) {$1$};
            \node[above=of 1] (2) {$2$};
            \node[above=of 2] (dots) {$\vdots$};
            \node[above=of dots] (inf) {$\infty$};
            \path (0) edge (1)
                  (1) edge (2)
                  (2) edge (dots)
                  (dots) edge (inf);
          \end{tikzpicture}
        }
        \only<3>{
          \centering
          Partially ordered semiring
          \begin{align*}
            + &= \wedge
          \end{align*}
          \begin{table}[]
            \begin{tabular}{c|cccc}
              $\cdot$      & $0$ & $\uparrow$   & $\downarrow$ & $\equiv$
              \\ \hline
              $0$          & $0$ & $0$          & $0$          & $0$
              \\
              $\uparrow$   & $0$ & $\uparrow$   & $\downarrow$ & $\equiv$
              \\
              $\downarrow$ & $0$ & $\downarrow$ & $\uparrow$   & $\equiv$
              \\
              $\equiv$     & $0$ & $\equiv$     & $\equiv$     & $\equiv$
            \end{tabular}
          \end{table}
          \begin{tikzcd}[ampersand replacement=\&, tips=false, column sep=0.5em,
                         row sep=0.5em]
            \& \ar{dl} 0 \ar{dr} \&
            \\
            \uparrow \ar{dr} \&\& \downarrow \ar{dl}
            \\
            \& \equiv \&
          \end{tikzcd}
        }
      \end{column}
      \begin{column}{0.5\textwidth}
        \minipage[c][0.65\textheight][s]{\columnwidth}
        \centering
        Symmetric promonoidal category
        \vfill
        \only<1>{
          Bags of keys, under union
          \vfill
          \begin{tikzpicture}[->]
            \node (*) {$*$};
            \path (*) edge[loop above] (*)
                  (*) edge[loop, in=60, out=120, distance=1.0cm] (*)
                  (*) edge[loop, in=45, out=135, distance=2.0cm] node[above] {$\vdots$} (*);
          \end{tikzpicture}
        }
        \only<2>{
          \begin{align*}
            \mathcal{T}
          \end{align*}
          \vfill
          \begin{tikzpicture}[->]
            \node (*) {$*$};
            \path (*) edge[loop above] (*)
                  (*) edge[loop, in=60, out=120, distance=1.0cm] (*)
                  (*) edge[loop, in=45, out=135, distance=2.0cm] node[above] {$\vdots$} (*);
          \end{tikzpicture}
        }
        \only<3>{
          Trivial
        }
        \endminipage
      \end{column}
    \end{columns}
  \end{frame}
  \begin{frame}
    \frametitle{Function}
    \begin{itemize}
      \item Introduction:
        \inferrule{\ctx{\Gamma}{\Delta}, \ctxvar{x}{S}{1} \vdash T \ni \bind{x}{s}}
                  {\ctx{\Gamma}{\Delta} \vdash \lam{x}{s} \ni \fun{S}{T}}
      \item Elimination:
        \inferrule{\ctx{\Gamma}{\Delta_e} \vdash e \in \fun{S}{T}
                   \\ \ctx{\Gamma}{\Delta_s} \vdash S \ni s
                   \\ \rescomment{\Delta \leq \Delta_e + \Delta_s}}
                  {\ctx{\Gamma}{\Delta} \vdash \app{e}{s} \in T}
    \end{itemize}
  \end{frame}
  \begin{frame}
    \frametitle{Products}
    \begin{table}[]
      \centering
      \begin{tabular}{c|c}
        With product & Tensor product
        \\ \midrule
        $\withT{A}{B}$ & $\tensor{A}{B}$
        \pause
        \\ \midrule
        Cartesian product
        &
        \makecell{Closed symmetric \\ monoidal product}
        \\
        \begin{tikzcd}[-o, ampersand replacement=\&, column sep=2em, row sep=3em]
          \& \ar[swap]{dl}{f} C \ar[dashrightarrow,swap,near end]{d}{\langle f,g \rangle} \ar{dr}{g} \& \\
          A \& \ar{l}{\pi_0} \withT{A}{B} \ar[swap]{r}{\pi_1} \& B
        \end{tikzcd}
        &
        $\begin{aligned}
          &\fun{(\tensor{A}{B})}{C} \\
          &\quad \cong \fun{A}{(\fun{B}{C})}
        \end{aligned}$
        \pause
        \\ \midrule
        $\Pi(t : \mathbf{2})~\mathrm{if}~t~\mathrm{then}~A~\mathrm{else}~B$
        &
        $\Sigma(\_ : A)~B$
        %\makecell{Defined via elimination \\ (projection)}
        %&
        %\makecell{Defined via introduction \\ (split-resource pairing)}
      \end{tabular}
    \end{table}
  \end{frame}
  \begin{frame}
    \frametitle{With product}
    \begin{itemize}
      \item Introduction:
        \inferrule{\ctx{\Gamma}{\Delta} \vdash S_0 \ni s_0
                   \\ \ctx{\Gamma}{\Delta} \vdash S_1 \ni s_1}
                  {\ctx{\Gamma}{\Delta} \vdash \withT{S_0}{S_1} \ni \wth{s_0}{s_1}}
      \item Elimination:
        \inferrule{\ctx{\Gamma}{\Delta} \vdash e \in \withT{S_0}{S_1}
                   \\ i \in \{0,1\}}
                  {\ctx{\Gamma}{\Delta} \vdash \proj{i}{e} \in S_i}
      \item Defined via elimination
    \end{itemize}
  \end{frame}
  \begin{frame}
    \frametitle{Tensor product}
    \begin{itemize}
      \item Introduction:
        \inferrule{\ctx{\Gamma}{\Delta_0} \vdash S_0 \ni s_0
                   \\ \ctx{\Gamma}{\Delta_1} \vdash S_1 \ni s_1
                   \\\\ \rescomment{\Delta \leq \Delta_0 + \Delta_1}}
                  {\ctx{\Gamma}{\Delta} \vdash \tensor{S_0}{S_1} \ni \ten{s_0}{s_1}}
      \item Elimination:
        \inferrule{\ctx{\Gamma}{\Delta_e} \vdash e \in \tensor{S_0}{S_1}
                   \\\\ \ctx{\Gamma}{\Delta_s},
                        \ctxvar{x}{S_0}{1}, \ctxvar{y}{S_1}{1} \vdash \bind{x,y}{s} \in T
                   \\\\ \rescomment{\Delta \leq \Delta_e + \Delta_s}}
                  {\ctx{\Gamma}{\Delta} \vdash \prm{T}{e}{\bind{x,y}{s}} \in T}
      \item Defined via introduction
    \end{itemize}
  \end{frame}
  \begin{frame}
    \frametitle{Sum}
    \begin{itemize}
      \item Introduction:
        \inferrule{\ctx{\Gamma}{\Delta} \vdash S_i \ni s_i \\ i \in \{0,1\}}
                  {\ctx{\Gamma}{\Delta} \vdash \sumT{S_0}{S_1} \ni \bang{s}}
      \item Elimination:
        \inferrule{\ctx{\Gamma}{\Delta_e} \vdash e \in \sumT{S_0}{S_1}
                   \\ \ctx{\Gamma}{\Delta_s}, \ctxvar{x}{S_0}{1}
                      \vdash T \ni \bind{x}{s_0}
                   \\ \ctx{\Gamma}{\Delta_s}, \ctxvar{x}{S_1}{1}
                      \vdash T \ni \bind{x}{s_1}
                   \\ \rescomment{\Delta \leq \Delta_e + \Delta_s}}
                  {\ctx{\Gamma}{\Delta} \vdash \cse{T}{e}{\bind{x}{s_0}}{\bind{x}{s_1}} \in T}
    \end{itemize}
  \end{frame}
  \begin{frame}
    \frametitle{Bang}
    \begin{itemize}
      \item Introduction:
        \inferrule{\ctx{\Gamma}{\Delta_s} \vdash S \ni s
                   \\ \rescomment{\Delta \leq \rho \cdot \Delta_s}}
                  {\ctx{\Gamma}{\Delta} \vdash \excl{\rho}{S} \ni \bang{s}}
      \item Elimination:
        \inferrule{\ctx{\Gamma}{\Delta_e} \vdash e \in \excl{\rho}{S}
                   \\ \ctx{\Gamma}{\Delta_s}, \ctxvar{x}{S}{\rho}
                      \vdash T \ni \bind{x}{s}
                   \\ \rescomment{\Delta \leq \Delta_e + \Delta_s}}
                  {\ctx{\Gamma}{\Delta} \vdash \bm{T}{e}{\bind{x}{s}} \in T}
      \item Graded comonad:
        \begin{mathpar}
          \excl{1}{A} \to A
          \\
          \excl{\pi \cdot \rho}{A} \to \excl{\pi}{\excl{\rho}{A}}
        \end{mathpar}
    \end{itemize}
  \end{frame}
\end{document}
